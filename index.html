<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Maquipan - Sistema de Gestión</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome para iconos -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <!-- SweetAlert2 para las notificaciones -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- SheetJS para Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-m">M</div>
                <div class="logo-text">MAQUIPAN</div>
                <div class="logo-subtitle">SERVICIO TÉCNICO</div>
            </div>
            <nav class="nav-menu">
                <a onclick="router.navigate('dashboard')" class="nav-link active">HOME</a>
                <a onclick="router.navigate('requerimientos')" class="nav-link">REQUERIMIENTOS</a>
                <a onclick="router.navigate('cotizaciones')" class="nav-link">COTIZACIONES</a>
                <a onclick="router.navigate('clientes')" class="nav-link">CLIENTES</a>
                <!-- Agregar este enlace para repuestos -->
                <a onclick="router.navigate('repuestos')" class="nav-link">REPUESTOS</a>
                <a onclick="router.navigate('busqueda')" class="nav-link">BÚSQUEDA</a>
                <a onclick="auth.logout()" class="nav-link">SALIR</a>
            </nav>
        </div>
    </header>
    <div class="user-section">
        <div class="user-info" id="userInfo">
            <!-- Nombre de usuario se carga dinámicamente -->
        </div>
    </div>
    <main class="main-container">
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li><a onclick="router.navigate('nuevo-requerimiento')" class="sidebar-link">NUEVO REQUERIMIENTO</a></li>
                <li><a onclick="router.navigate('nueva-cotizacion')" class="sidebar-link">NUEVA COTIZACIÓN</a></li>
                <li><a onclick="router.navigate('nuevo-cliente')" class="sidebar-link">NUEVO CLIENTE</a></li>
                <!-- Agregar este enlace en la barra lateral -->
                <li><a onclick="router.navigate('repuestos')" class="sidebar-link">GESTIÓN DE REPUESTOS</a></li>
                <li><a onclick="router.navigate('reportes')" class="sidebar-link">REPORTES</a></li>
                <li><a onclick="router.navigate('configuracion')" class="sidebar-link">CONFIGURACIÓN</a></li>
            </ul>
        </aside>
        <div class="main-content" id="app">
            <!-- El contenido se carga dinámicamente aquí -->
        </div>
    </main>
    
    <!-- Bootstrap JavaScript Bundle con Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- Librería para generar PDFs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- NUEVO: Sistema de gestión de modales mejorado -->
<script src="js/modal-manager-improved.js"></script>

<!-- Tus scripts en el orden correcto -->
<script src="js/services/firebase-config.js"></script>
<script src="js/storage.js"></script>
<script src="js/auth.js"></script>
<script src="js/router.js"></script>
<script src="js/components/dashboard.js"></script>
<script src="js/components/requerimientos.js"></script>
<script src="js/components/cotizaciones.js"></script>
<script src="js/components/clientes.js"></script>
<script src="js/components/busqueda.js"></script>
<script src="js/components/locales.js"></script>
<script src="js/components/repuestos.js"></script>
<script src="js/components/nuevo-cliente.js"></script>
<!-- IMPORTANTE: Agregar el generador de PDF -->
<script src="js/components/pdf-generator.js"></script>
<!-- La aplicación principal DEBE ir al final -->
<script src="js/app.js"></script>

    <!-- Opcional: Agregar un favicon para evitar errores 404 -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Script de diagnóstico -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Sistema cargado correctamente');
        
        // Verificar que todas las dependencias estén cargadas
        const dependencias = {
            'Bootstrap': typeof bootstrap !== 'undefined',
            'Firebase': typeof firebase !== 'undefined',
            'ModalManager': typeof ModalManager !== 'undefined',
            'jsPDF': typeof window.jspdf !== 'undefined',
            'SweetAlert2': typeof Swal !== 'undefined',
            'SheetJS': typeof XLSX !== 'undefined'
        };
        
        console.table(dependencias);
        
        // Verificar componentes principales
        const componentes = {
            'Router': typeof router !== 'undefined',
            'Auth': typeof auth !== 'undefined',
            'Storage': typeof storage !== 'undefined'
        };
        
        console.table(componentes);
        
        // Mostrar advertencia si faltan dependencias críticas
        const faltantes = Object.entries(dependencias)
            .filter(([_, loaded]) => !loaded)
            .map(([name]) => name);
            
        if (faltantes.length > 0) {
            console.warn('ADVERTENCIA: Las siguientes dependencias no están cargadas:', faltantes);
            
            // Mostrar alerta al usuario solo si faltan componentes críticos
            if (!dependencias['Bootstrap'] || !dependencias['Firebase'] || !dependencias['ModalManager']) {
                setTimeout(() => {
                    alert('Algunas dependencias críticas no se han cargado correctamente. Es posible que el sistema no funcione como se espera. Por favor, recargue la página o contacte al administrador.');
                }, 1000);
            }
        }
    });
    </script>
</body>
</html>
